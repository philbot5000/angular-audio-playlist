"use strict";angular.module("audioPlaylistApp",["ngCookies","ngResource","ngSanitize","com.philmerrell.audioPlaylist","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("audioPlaylistApp").controller("MainCtrl",["$scope","audioPlaylistService",function(a,b){a.myRadPlaylist=[{order:0,name:"Dustin Wong",song:"Talking Walking Cloud",src:"http://s3.amazonaws.com/Treefort-Music-Fest/dustinwong.mp3"},{order:1,name:"Delicate Steve",song:"Butterfly",src:"http://s3.amazonaws.com/Treefort-Music-Fest/delicatesteve.mp3"},{order:2,name:"Holiday Friends",song:"Asteral Observations",src:"http://s3.amazonaws.com/Treefort-Music-Fest/holidayfriends.mp3"},{order:3,name:"Janka Nabay",song:"Eh Congo",src:"http://s3.amazonaws.com/Treefort-Music-Fest/jankanabay.mp3",url:""},{order:4,name:"Mr. Gnome",song:"Vampires",src:"http://s3.amazonaws.com/Treefort-Music-Fest/mrgnome.mp3",url:"http://s3.amazonaws.com/Treefort-Music-Fest/jankanabay.mp3"},{order:5,name:"Why?",song:"The Vowels, Pt. 2",src:"http://s3.amazonaws.com/Treefort-Music-Fest/why.mp3",url:"",twitter:""},{order:6,name:"Talk Demonic",song:"Shattered Into Dyes",src:"http://s3.amazonaws.com/Treefort-Music-Fest/talkdemonic.mp3"},{order:7,name:"Soft White Sixties",song:"Queen of the Press Club",src:"http://s3.amazonaws.com/Treefort-Music-Fest/thesoftwhitesixties.mp3"},{order:8,name:"Pictureplane",song:"Real is a Feeling",src:"http://s3.amazonaws.com/Treefort-Music-Fest/pictureplane.mp3"},{order:9,name:"Blitzen Trapper",song:"Might Find it Cheap",src:"http://s3.amazonaws.com/Treefort-Music-Fest/blitzentrapper.mp3"}],a.playlists=[{name:"Treefort Music Fest 2012 - Thursday",list:[{order:0,name:"Dustin Wong",song:"Talking Walking Cloud",src:"http://s3.amazonaws.com/Treefort-Music-Fest/dustinwong.mp3"},{order:1,name:"Delicate Steve",song:"Butterfly",src:"http://s3.amazonaws.com/Treefort-Music-Fest/delicatesteve.mp3"},{order:2,name:"Holiday Friends",song:"Asteral Observations",src:"http://s3.amazonaws.com/Treefort-Music-Fest/holidayfriends.mp3"},{order:3,name:"Janka Nabay",song:"Eh Congo",src:"http://s3.amazonaws.com/Treefort-Music-Fest/jankanabay.mp3",url:""},{order:3,name:"Mr. Gnome",song:"Vampires",src:"http://s3.amazonaws.com/Treefort-Music-Fest/mrgnome.mp3",url:"http://s3.amazonaws.com/Treefort-Music-Fest/jankanabay.mp3"}]},{name:"Treefort Music Fest 2012 - Friday",list:[{order:0,name:"Why?",song:"The Vowels, Pt. 2",src:"http://s3.amazonaws.com/Treefort-Music-Fest/why.mp3",url:"",twitter:""},{order:1,name:"Talk Demonic",song:"Shattered Into Dyes",src:"http://s3.amazonaws.com/Treefort-Music-Fest/talkdemonic.mp3"},{order:2,name:"Soft White Sixties",song:"Queen of the Press Club",src:"http://s3.amazonaws.com/Treefort-Music-Fest/thesoftwhitesixties.mp3"},{order:3,name:"Pictureplane",song:"Real is a Feeling",src:"http://s3.amazonaws.com/Treefort-Music-Fest/pictureplane.mp3"},{order:4,name:"Blitzen Trapper",song:"Might Find it Cheap",src:"http://s3.amazonaws.com/Treefort-Music-Fest/blitzentrapper.mp3"}]}],a.playThisList=function(){b.setPlaylist([{order:0,name:"Prince",song:"Raspberry Baret",src:"audio/bowie.mp3",url:"",twitter:""},{order:1,name:"The Gap Band",song:"You Dropped a Bomb on Me",src:"http://reviewstalker.com/wp-content/uploads/2011/10/03-Winter-68.mp3"},{order:2,name:"Roy Orbison",song:"Only the Lonely",src:"http://reviewstalker.com/wp-content/uploads/2011/10/03-Winter-68.mp3"}])}}]),angular.module("com.philmerrell.audioPlaylist",[]).directive("audioPlaylist",["audioPlaylistService",function(a){return{templateUrl:"views/audio-playlist.html",restrict:"E",replace:!0,scope:{playlist:"="},controller:"audioPlaylistController",link:function(b,c,d,e){var f=c.find('input[type="range"]')[0],g=c.find("audio")[0];b.audio=g,g.src=b.currentlyPlaying.src;var h=c.find("button");h.bind("click",function(){e.toggleAudio()}),g.addEventListener("timeupdate",function(){var a=this.currentTime,c=this.duration;b.$apply(function(){b.currentTime=e.timeElapsed(a),b.remainingTime=e.timeRemaining(c,a),b.percentElapsed=e.percentElapsed(c,a)})}),g.addEventListener("playing",function(){b.$apply(function(){b.player.buttonIcon=e.playerControls.pauseIcon})}),g.addEventListener("pause",function(){b.$apply(function(){b.player.buttonIcon=e.playerControls.playIcon})}),g.addEventListener("ended",function(){e.nextTrack()}),g.addEventListener("progress",function(){var a=this.duration,c=this.buffered.end(0);b.$apply(function(){b.percentLoaded=e.percentLoaded(a,c)})}),g.addEventListener("waiting",function(){b.$apply(function(){b.player.buttonIcon=e.playerControls.loadingIcon})});var i=function(){var a=f.value/(100/g.duration);g.currentTime=a};f.addEventListener("change",i,!1),f.addEventListener("input",function(){f.removeEventListener("change",i,!1);var a=f.value/(100/g.duration);g.currentTime=a}),b.$watch(function(){return a.getPlaylist()},function(a){"undefined"!=typeof a&&e.loadPlaylist(a)},!0)}}}]).controller("audioPlaylistController",["$scope","$attrs","audioPlaylistService",function(a,b,c){a.currentlyPlaying=a.playlist[0],this.playerControls={playIcon:'<span class="player-play"></span>',pauseIcon:'<span class="player-pause"></span>',loadingIcon:'<span class="player-circle-o-notch player-spin"></span>'},a.player={buttonIcon:this.playerControls.playIcon},this.loadPlaylist=function(){a.playlist=c.getPlaylist(),a.audio.src=a.playlist[0].src,a.currentlyPlaying=a.playlist[0],a.audio.load(),a.audio.play()},this.timeElapsed=function(a){var b=a,c=Math.floor(b%60),d=10>c?"0"+c:c,e=Math.floor(b/60%60),f=10>e?"0"+e:e,g=Math.floor(b/60/60%60);return 0===g?f+":"+d:g+":"+f+":"+d},this.timeRemaining=function(a,b){var c=a,d=b,e=c-d,f=Math.floor(e%60)||0,g=10>f?"0"+f:f,h=Math.floor(e/60%60)||0,i=10>h?"0"+h:h,j=Math.floor(e/60/60%60)||0;return 0===j?"-"+i+":"+g:"-"+j+":"+i+":"+g},this.percentLoaded=function(a,b){return parseInt(b/a*100,10)},this.percentElapsed=function(a,b){return Math.floor(100/a*b)||0},this.toggleAudio=function(){a.audio.paused?a.audio.play():a.audio.pause()},this.nextTrack=function(){var b=a.currentlyPlaying.order+1;a.playlist.length>b?(console.log(a.playlist[b]),a.currentlyPlaying=a.playlist[b],a.audio.src=a.playlist[b].src,a.audio.load(),a.audio.play()):(a.currentlyPlaying=a.playlist[0],a.audio.src=a.playlist[0].src,a.audio.currentTime=0,a.audio.pause())},a.previousTrack=function(){var b=a.currentlyPlaying.order-1;0>b?a.currentlyPlaying=a.playlist[0]:(a.audio.src=a.playlist[b].src,a.currentlyPlaying=a.playlist[b],a.audio.load(),a.audio.play())},a.playTrack=function(b){a.audio.src=b.src,a.currentlyPlaying=b,a.audio.load(),a.audio.play()}}]).factory("audioPlaylistService",function(){var a=this;return this.playlist=null,{setPlaylist:function(b){a.playlist=b},getPlaylist:function(){return null!==a.playlist?a.playlist:void 0}}});